<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detalhes da Reclamação</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>

<body data-guard="true">

  <div class="app">

    <!-- Navbar -->
    <div class="navbar card">
      <div class="brand">
        <div class="logo">CQ</div>
        <div>
          <div style="font-weight:800;">Detalhes</div>
          <div class="small user-email"></div>
        </div>
      </div>

      <div class="nav-actions">
        <button class="btn ghost" onclick="location.href='complaint-list.html'">Voltar</button>
      </div>
    </div>

    <div class="card" style="max-width:760px; margin:auto">

      <h1 class="h1">Reclamação</h1>

      <div id="detail" class="small" style="margin-top:12px;">
        Carregando...
      </div>

    </div>

  </div>

  <script src="firebase.js"></script>
  <script src="auth.js"></script>
  <script src="auth-guard.js"></script>
  <script src="app.js"></script>

  <script>
    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    async function loadDetail() {
      if (!id) {
        document.getElementById("detail").innerHTML = "ID inválido.";
        return;
      }

      const doc = await db.collection("complaints").doc(id).get();
      if (!doc.exists) {
        document.getElementById("detail").innerHTML = "Reclamação não encontrada.";
        return;
      }

      const data = doc.data();

      const dt = data.createdAt
        ? new Date(data.createdAt.seconds * 1000).toLocaleString()
        : "—";

      document.getElementById("detail").innerHTML = `
        <strong>${data.title}</strong><br><br>

        <div class="small"><b>Empresa:</b> ${data.company}</div>
        <div class="small"><b>Status:</b> 
          <span class="badge ${data.status === 'open' ? 'open' : 'closed'}">
            ${data.status === 'open' ? 'Aberta' : 'Fechada'}
          </span>
        </div>
        <div class="small"><b>Criado em:</b> ${dt}</div>

        <hr style="border-color:rgba(255,255,255,0.08); margin:18px 0;">

        <div class="small"><b>Descrição:</b></div>
        <p>${data.description}</p>

        <hr style="border-color:rgba(255,255,255,0.08); margin:18px 0;">

        <div class="small"><b>Resposta da empresa:</b></div>
        <p>${data.response ? data.response : '<i>(Ainda sem resposta)</i>'}</p>
      `;
    }

    loadDetail();
  </script>

</body>
</html>
