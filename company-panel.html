<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Painel da Empresa</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>

<body data-guard="true">

  <div class="app">

    <!-- NAVBAR -->
    <div class="navbar card">
      <div class="brand">
        <div class="logo">CQ</div>
        <div>
          <div style="font-weight:800;">Painel da Empresa</div>
          <div class="small user-email"></div>
        </div>
      </div>

      <div class="nav-actions">
        <button class="btn ghost" onclick="location.href='home.html'">Voltar</button>
      </div>
    </div>

    <!-- LAYOUT -->
    <div class="grid">

      <!-- MENU LATERAL INTELIGENTE -->
      <div class="sidebar card">
        <ul class="nav-list">

          <!-- SEMPRE EXIBE -->
          <li><a href="home.html">üè† Menu principal</a></li>

          <!-- MENU DO USU√ÅRIO NORMAL -->
          <span id="menu-user">
            <li><a href="complaint-create.html">‚ûï Criar reclama√ß√£o</a></li>
            <li><a href="complaint-list.html">üìã Minhas reclama√ß√µes</a></li>
          </span>

          <!-- MENU DA EMPRESA (ATUALIZADO) -->
          <span id="menu-company">
            <li><a class="active" href="company-panel.html">üè¢ Painel da empresa</a></li>
            <li><a href="company-profile.html">üë§ Perfil da empresa</a></li>
          </span>

        </ul>
      </div>

      <!-- CONTE√öDO PRINCIPAL -->
      <div class="card">
        <h1 class="h1">Reclama√ß√µes</h1>

        <div id="company-list" style="margin-top:16px;">
          Carregando...
        </div>
      </div>

    </div>

  </div>

  <!-- SCRIPTS GERAIS -->
  <script src="firebase.js"></script>
  <script src="auth.js"></script>
  <script src="auth-guard.js"></script>
  <script src="app.js"></script>

  <!-- üî• MENU INTELIGENTE + L√ìGICA DA EMPRESA -->
  <script>
    auth.onAuthStateChanged(async user => {
      if (!user) {
        location.href = "company-login.html";
        return;
      }

      try {
        const snap = await db.collection("users").doc(user.uid).get();

        if (!snap.exists) {
          alert("Erro: cadastro empresarial n√£o encontrado.");
          auth.signOut();
          return;
        }

        const data = snap.data();

        const menuUser = document.getElementById("menu-user");
        const menuCompany = document.getElementById("menu-company");

        // Somente empresa acessa aqui
        if (data.type === "company") {
          menuCompany.style.display = "block";
          menuUser.style.display = "none";
        } else {
          alert("Acesso negado: esta conta n√£o √© de empresa.");
          auth.signOut();
          return;
        }

        // Nome real da empresa salvo no Firestore
        const companyName = data.companyName;

        // Carregar reclama√ß√µes desta empresa
        app.loadAllComplaintsForCompany(companyName);

      } catch (err) {
        console.error(err);
        document.getElementById("company-list").innerHTML =
          "Erro ao carregar dados da empresa.";
      }
    });

    // Bot√£o de resposta
    window.openResponse = function (id) {
      window.location.href = "company-response.html?id=" + id;
    };
  </script>

</body>
</html>
